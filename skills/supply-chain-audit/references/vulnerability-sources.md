# Vulnerability Sources

Reference for vulnerability databases, scanning tools, CVE severity scoring, and cross-database
correlation. Used by the supply-chain-audit skill and the dependency-audit-agent to identify,
verify, and prioritize known vulnerabilities in project dependencies.

---

## Vulnerability Databases

### National Vulnerability Database (NVD)

**URL:** https://nvd.nist.gov/
**Maintained by:** NIST (National Institute of Standards and Technology)
**Coverage:** All software with assigned CVE identifiers
**Update frequency:** Continuous (typically within hours of CVE publication)

**What it provides:**
- CVE descriptions with affected software configurations (CPE)
- CVSS v3.1 base scores computed by NIST analysts
- References to advisories, patches, and exploit code
- CWE classification for each vulnerability

**Strengths:**
- Authoritative CVSS scoring by trained analysts
- Comprehensive coverage across all software ecosystems
- Structured data via API (NVD API 2.0)
- Historical data back to 1999

**Limitations:**
- Scoring can lag days or weeks behind CVE publication
- CPE matching is imprecise for packages with ecosystem-specific names
- Does not map directly to package manager names (e.g., NuGet package IDs)
- Overloaded with volume -- thousands of CVEs per month

**API usage:**
```
GET https://services.nvd.nist.gov/rest/json/cves/2.0?cveId=CVE-2024-12345
GET https://services.nvd.nist.gov/rest/json/cves/2.0?keywordSearch=log4j
```

### GitHub Advisory Database

**URL:** https://github.com/advisories
**Maintained by:** GitHub Security Lab + community contributors
**Coverage:** Packages in npm, pip, NuGet, Maven, RubyGems, Go, Rust, Erlang, Swift, Pub
**Update frequency:** Continuous with community review

**What it provides:**
- Advisories mapped directly to package ecosystem names and version ranges
- CVSS scores (often from NVD, sometimes GitHub's own assessment)
- Affected version ranges in package manager format
- Patched version information
- GHSA identifiers in addition to CVE identifiers

**Strengths:**
- Direct mapping to package manager names and versions
- Affected version ranges use ecosystem-native format (semver for npm, PEP 440 for pip)
- Community-reviewed and curated
- Integrated with GitHub Dependabot and npm audit
- Open source dataset (github/advisory-database)

**Limitations:**
- Coverage weighted toward popular ecosystems (npm, pip have more entries)
- Some advisories lack CVSS scores
- Community contributions can introduce inconsistencies
- NuGet coverage is less comprehensive than npm or pip

**API usage:**
```graphql
# GitHub GraphQL API
query {
  securityAdvisories(first: 10, identifier: {type: CVE, value: "CVE-2024-12345"}) {
    nodes {
      ghsaId
      summary
      severity
      vulnerabilities(first: 5) {
        nodes {
          package { ecosystem name }
          vulnerableVersionRange
          firstPatchedVersion { identifier }
        }
      }
    }
  }
}
```

### Open Source Vulnerability Database (OSV)

**URL:** https://osv.dev/
**Maintained by:** Google Open Source Security Team
**Coverage:** Multi-ecosystem (npm, PyPI, crates.io, Go, NuGet, Maven, and more)
**Update frequency:** Continuous, aggregates from multiple sources

**What it provides:**
- Unified schema for vulnerabilities across ecosystems
- Aggregated data from GitHub Advisory, PyPI, RustSec, Go Vulnerability Database, and others
- Affected version ranges with commit-level precision (when available)
- OSV identifiers that cross-reference CVE, GHSA, and ecosystem-specific IDs

**Strengths:**
- Single API for querying across all ecosystems
- Aggregates from multiple authoritative sources
- Open source schema and tooling (osv-scanner)
- Commit-level affected ranges for precise version matching
- JSON-based API with batch query support

**Limitations:**
- Aggregation can introduce duplicate entries
- Severity scores come from source databases (may vary)
- Newer database with less historical depth than NVD
- NuGet coverage depends on upstream sources

**API usage:**
```bash
# Query by package
curl -X POST https://api.osv.dev/v1/query \
  -d '{"package": {"name": "lodash", "ecosystem": "npm"}, "version": "4.17.20"}'

# Query by CVE
curl -X POST https://api.osv.dev/v1/query \
  -d '{"commit": "", "version": "", "package": {}, "id": "CVE-2024-12345"}'
```

### Ecosystem-Specific Databases

| Ecosystem | Database | URL | Notes |
|-----------|----------|-----|-------|
| npm | npm Advisory Database | https://www.npmjs.com/advisories | Integrated with `npm audit` |
| PyPI | PyPI Advisory Database | https://github.com/pypa/advisory-database | Used by `pip-audit` |
| NuGet | NuGet Vulnerability Database | https://nuget.org | Integrated with `dotnet list package --vulnerable` |
| RubyGems | RubySec Advisory Database | https://rubysec.com | Used by `bundler-audit` |
| Go | Go Vulnerability Database | https://vuln.go.dev | Used by `govulncheck` |
| Rust | RustSec Advisory Database | https://rustsec.org | Used by `cargo audit` |

---

## Scanning Tools by Ecosystem

### NuGet (.NET)

**Built-in:**
```bash
# Check for vulnerable packages (requires .NET 6+)
dotnet list package --vulnerable
dotnet list package --vulnerable --include-transitive

# Check for outdated packages
dotnet list package --outdated
dotnet list package --outdated --include-prerelease

# Restore and audit in one step (.NET 8+)
dotnet restore --audit
```

**Configuration for NuGetAudit (.NET 8+):**
```xml
<!-- In .csproj or Directory.Build.props -->
<PropertyGroup>
  <NuGetAudit>true</NuGetAudit>
  <NuGetAuditLevel>low</NuGetAuditLevel>
  <NuGetAuditMode>all</NuGetAuditMode>  <!-- direct or all (includes transitive) -->
</PropertyGroup>
```

**Third-party:**
- **Snyk:** `snyk test` -- commercial scanner with free tier, good NuGet support
- **OWASP Dependency-Check:** Scans .NET projects against NVD
- **WhiteSource/Mend Renovate:** Automated PR-based dependency updates

### npm (Node.js)

**Built-in:**
```bash
# Full audit with JSON output
npm audit --json

# Audit only production dependencies
npm audit --omit=dev

# Audit with severity threshold
npm audit --audit-level=high

# Fix automatically (use with caution)
npm audit fix
npm audit fix --force  # allows major version bumps (DANGEROUS)

# Check outdated packages
npm outdated --json
```

**Third-party:**
- **Snyk:** `snyk test` -- deep transitive analysis, reachability analysis
- **Socket:** Socket.dev -- detects supply chain attacks (typosquatting, install scripts)
- **npm-check-updates:** `ncu` -- interactive upgrade tool

### pip (Python)

**pip-audit (recommended):**
```bash
# Install
pip install pip-audit

# Basic scan
pip-audit

# JSON output
pip-audit --format=json

# Scan a requirements file without installing
pip-audit --requirement=requirements.txt

# Scan with fix suggestions
pip-audit --fix --dry-run

# Use OSV as the vulnerability source
pip-audit --vulnerability-service=osv
```

**safety (alternative):**
```bash
# Install
pip install safety

# Basic check
safety check

# Check a requirements file
safety check --file=requirements.txt

# JSON output
safety check --json
```

**Third-party:**
- **Snyk:** `snyk test --file=requirements.txt`
- **Bandit:** Static analysis for Python security issues (not dependency-focused)
- **pyup.io:** Automated dependency update service

---

## CVE Severity Scoring (CVSS)

### CVSS v3.1 Base Score Components

The Common Vulnerability Scoring System (CVSS) v3.1 base score is computed from eight metrics
organized into two groups.

**Exploitability Metrics:**

| Metric | Values | Description |
|--------|--------|-------------|
| Attack Vector (AV) | Network (N), Adjacent (A), Local (L), Physical (P) | How the attacker reaches the vulnerable component |
| Attack Complexity (AC) | Low (L), High (H) | Conditions beyond attacker control required for exploitation |
| Privileges Required (PR) | None (N), Low (L), High (H) | Level of authentication needed |
| User Interaction (UI) | None (N), Required (R) | Whether a user must take action |

**Impact Metrics:**

| Metric | Values | Description |
|--------|--------|-------------|
| Confidentiality (C) | None (N), Low (L), High (H) | Impact on information disclosure |
| Integrity (I) | None (N), Low (L), High (H) | Impact on data modification |
| Availability (A) | None (N), Low (L), High (H) | Impact on service disruption |
| Scope (S) | Unchanged (U), Changed (C) | Whether the vulnerability affects resources beyond its component |

### Reading a CVSS Vector String

```
CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H  = 10.0 (Critical)
          ^    ^    ^    ^   ^   ^   ^   ^
          |    |    |    |   |   |   |   +-- Availability: High
          |    |    |    |   |   |   +------ Integrity: High
          |    |    |    |   |   +---------- Confidentiality: High
          |    |    |    |   +-------------- Scope: Changed
          |    |    |    +------------------ User Interaction: None
          |    |    +----------------------- Privileges Required: None
          |    +---------------------------- Attack Complexity: Low
          +--------------------------------- Attack Vector: Network
```

This is the worst case: remotely exploitable, no authentication, no user interaction,
scope-changing, full CIA impact.

### Contextual Risk Adjustment Framework

Raw CVSS is a starting point. Adjust for your project's context using these factors:

**Factor 1: Reachability**

| Reachability | Adjustment | Rationale |
|-------------|------------|-----------|
| Vulnerable code path directly invoked by project | No adjustment | Full exposure |
| Vulnerable code path reachable through project's usage pattern | Reduce by 0-1 | Partial exposure |
| Vulnerable code path NOT invoked by project | Reduce by 2-4 | Theoretical only |
| Package imported but vulnerable module not used | Reduce by 3-5 | Very low exposure |
| Transitive dependency, 3+ levels deep, usage unknown | Reduce by 1-2 | Uncertain exposure |

**Factor 2: Exposure**

| Deployment Context | Adjustment | Rationale |
|-------------------|------------|-----------|
| Internet-facing, public API | No adjustment | Maximum exposure |
| Internet-facing, behind WAF/CDN | Reduce by 0-1 | Some mitigation |
| Internal network only | Reduce by 1-2 | Limited attacker access |
| Isolated/air-gapped environment | Reduce by 2-3 | Very limited access |
| Development/CI only (not in production artifact) | Reduce by 3-4 | Not deployed |

**Factor 3: Data Sensitivity**

| Data Handled | Adjustment |
|-------------|------------|
| Financial/payment data (PCI scope) | Increase by 1 |
| PII/PHI (GDPR/HIPAA scope) | Increase by 1 |
| Authentication credentials | Increase by 1 |
| Public/non-sensitive data only | No adjustment |

### Cross-Database Correlation

When a vulnerability appears in multiple databases, correlate the information:

```
CVE-2024-12345:
  NVD:    CVSS 9.1 (Critical) -- scored 2024-01-15
  GHSA:   GHSA-xxxx-xxxx-xxxx -- severity HIGH, npm affected: <4.18.0
  OSV:    PYSEC-2024-001 -- PyPI affected: >=3.0.0,<3.5.2

Correlation notes:
- NVD and GHSA severity differ (Critical vs High)
- NVD CVSS may include broader impact scope
- Use GHSA version ranges for npm (ecosystem-native)
- Use OSV/PYSEC ranges for Python (more precise)
- Report BOTH severity ratings in audit findings
```

**Priority when sources disagree:**
1. Use ecosystem-specific database for version range accuracy
2. Use NVD for CVSS base score (most rigorous scoring process)
3. Use the HIGHER severity for initial prioritization
4. Note the discrepancy for human review and final determination

---

## Supply Chain Attack Patterns

Beyond known CVEs, be aware of these supply chain attack vectors:

### Typosquatting

Malicious packages with names similar to popular packages (e.g., `loadash` instead of `lodash`,
`python-dateutils` instead of `python-dateutil`). Detection: check for packages with suspiciously
low download counts and names similar to popular packages.

### Dependency Confusion

Exploits the package resolution order when both public and private registries are configured.
An attacker publishes a higher-version package with the same name as a private package on the
public registry. Detection: verify that private packages use scoped names (@company/package for
npm) or pinned registry sources.

### Account Takeover / Maintainer Compromise

A package maintainer's account is compromised, and a malicious version is published.
Detection: watch for unexpected version bumps, especially with new post-install scripts,
minified code additions, or network-calling code in packages that previously had none.

### Build-Time Attacks

Malicious code in install scripts (npm preinstall/postinstall, setup.py) that executes during
`npm install` or `pip install`. Detection: review install scripts for new packages, use
`--ignore-scripts` during audit, check for environment variable exfiltration or network calls.
